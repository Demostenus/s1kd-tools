README_SRC=DMC-S1000DTOOLS-A-00-00-00-00A-040A-D_EN-CA.XML
INTRO_SRC=DMC-S1000DTOOLS-A-00-00-00-00A-018A-D_EN-CA.XML
DEFAULTS_SRC=DMC-S1000DTOOLS-A-00-00-00-00A-014A-D_EN-CA.XML
INSTALL_SRC=DMC-S1000DTOOLS-A-00-00-00-00A-720A-D_EN-CA.XML
EXAMPLE_SRC=DMC-S1000DTOOLS-A-00-00-00-00A-130A-D_EN-CA.XML
COMPAT_SRC=DMC-S1000DTOOLS-A-00-00-00-00A-C30A-D_EN-CA.XML

README=../README.md
INTRO=../INTRO.md
DEFAULTS=../DEFAULTS.md
INSTALL_DOC=../INSTALL.md
EXAMPLE=../EXAMPLE.md
COMPAT=../COMPATIBILITY.md

S1KD2DB=s1kd2db
S1KD2DB_FLAGS+=-param include.emphasis.role 1

PANDOC_MD=pandoc -f docbook -t markdown_github -s
PANDOC_MAN=pandoc -f docbook -t man -s

PREFIX=/usr/local
MAN1_PREFIX=$(PREFIX)/share/man/man1
MAN5_PREFIX=$(PREFIX)/share/man/man5
INSTALL=install

all: s1kd-tools.1 s1kd-defaults.5 $(README) $(INTRO) $(DEFAULTS) $(INSTALL_DOC) $(EXAMPLE) $(COMPAT)

$(README): $(README_SRC) .icncatalog
	s1kd-icncatalog -m github $(README_SRC) | $(S1KD2DB) - | $(PANDOC_MD) -o $(README)

$(INTRO): $(INTRO_SRC)
	$(S1KD2DB) $(INTRO_SRC) $(S1KD2DB_FLAGS) | $(PANDOC_MD) -o $(INTRO)

$(DEFAULTS): $(DEFAULTS_SRC)
	$(S1KD2DB) $(DEFAULTS_SRC) $(S1KD2DB_FLAGS) | $(PANDOC_MD) -o $(DEFAULTS)

$(INSTALL_DOC): $(INSTALL_SRC)
	$(S1KD2DB) $(INSTALL_SRC) $(S1KD2DB_FLAGS) | $(PANDOC_MD) -o $(INSTALL_DOC)

$(EXAMPLE): $(EXAMPLE_SRC)
	$(S1KD2DB) $(EXAMPLE_SRC) $(S1KD2DB_FLAGS) | pandoc -f docbook -t markdown | pandoc -f markdown -t markdown_github -s --toc -o $(EXAMPLE)

$(COMPAT): $(COMPAT_SRC)
	$(S1KD2DB) $(COMPAT_SRC) $(S1KD2DB_FLAGS) | $(PANDOC_MD) -o $(COMPAT)

s1kd-tools.1: $(INTRO_SRC)
	$(S1KD2DB) $(INTRO_SRC) $(S1KD2DB_FLAGS) | $(PANDOC_MAN) -o $@

s1kd-defaults.5: $(DEFAULTS_SRC)
	$(S1KD2DB) $(DEFAULTS_SRC) $(S1KD2DB_FLAGS) | $(PANDOC_MAN) -o $@

.PHONY: clean install uninstall

clean:
	rm -f s1kd-tools.1 s1kd-defaults.5 $(README) $(INTRO) $(DEFAULTS) $(INSTALL_DOC) $(EXAMPLE) $(COMPAT)

install: s1kd-tools.1 s1kd-defaults.5
	$(INSTALL) s1kd-tools.1 $(MAN1_PREFIX)
	$(INSTALL) s1kd-defaults.5 $(MAN5_PREFIX)

uninstall:
	rm -f $(MAN1_PREFIX)/s1kd-tools.1
	rm -f $(MAN5_PREFIX)/s1kd-defaults.5
